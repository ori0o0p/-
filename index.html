<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #container {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 14px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #container div {
            margin: 10px;
        }

        #today {
            font-size: 1.2em;
        }

        #clock {
            font-size: 1em;
        }

        #change_video {
            width: 560px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            font-family: sans-serif;
        }

        #change_video:hover {
            background-color: snow;
        }

        #input {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            width: 560px;
        }

        #url {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            font-family: sans-serif;
        }

        #btn {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            font-family: sans-serif;
            cursor: pointer;
            width: 120px;
        }

        #btn:hover {
            background-color: snow;
        }

        #links {
            display: flex;
            flex-wrap: wrap;
            justify-content: left;
        }

    </style>
</head>
<body>

<div id="container">
    <div id="today">
        <!-- 현재 날짜 -->
    </div>
    <div id="clock">
        <!-- 현재 시간 -->
    </div>
    <iframe width="560" height="315" src=""
            title="YouTube video player"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
    <button id="change_video">
        직캠 변경
    </button>

    <div id="input">
        <label for="url"></label><input type="text" id="url">
        <button id="btn">
            직캠 추가
        </button>
    </div>

</div>

<div id="links">
    <!-- 영상 목록 -->
</div>

<div id="buttons">
    <button>
        모든 영상 확인
    </button>

    <button>
        숨기기
    </button>

    <button>
        초기화
    </button>
</div>

</body>
<script>
    class VideoPlayer {
        constructor() {
            this.links = [
                "https://www.youtube.com/embed/sXeYkw4VE24",
                "https://www.youtube.com/embed/stnXEC9Q3B4",
                "https://www.youtube.com/embed/UAQT5Hgrm1Q",
                "https://www.youtube.com/embed/FBx30Z3AEtQ",
                "https://www.youtube.com/embed/LTyc7mwLNys"
            ]
            this.cacheLink = null;
            this.isShow = false;
            this.init();
        }

        init() {
            this.setDateAndTime();
            this.setIntervals();
            this.addEventListeners();
        }

        setDateAndTime() {
            this.updateDateTime();
            setInterval(() => this.updateDateTime(), 1000);
        }

        updateDateTime() {
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const dayOfWeek = this.getDayOfWeek(date.getDay());
            const hours = this.getHours(date.getHours());
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();

            document.querySelector('#today').innerText = `${year}년 ${month}월 ${day}일 ${dayOfWeek}요일`;
            document.querySelector('#clock').innerText = this.setTime(hours, minutes, seconds);
        }

        getDayOfWeek(day) {
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            return days[day];
        }

        getHours(hours) {
            return hours > 12 ? hours - 12 : hours;
        }

        setTime(hours, minutes, seconds) {
            return `${hours}시 ${minutes}분 ${seconds}초`;
        }

        setIntervals() {
            setInterval(() => this.checkBreakTime(), 1001);
        }

        checkBreakTime() {
            const date = new Date();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();

            if ((hours < 14 || hours > 18) && minutes === 29 && seconds === 39) {
                alert('쉬는 시간까지 20초 남음');
            } else if ((hours >= 14 && hours <= 18) && minutes === 19 && seconds === 39) {
                alert('쉬는 시간까지 20초 남음');
            }
        }

        addEventListeners() {
            document.querySelector('#change_video').addEventListener('click', () => this.changeVideo());
            document.querySelector('#btn').addEventListener('click', () => this.addLinks());
            document.querySelector('#buttons button:nth-child(1)').addEventListener('click', () => this.allLinks());
            document.querySelector('#buttons button:nth-child(2)').addEventListener('click', () => this.hideAllLinks());
            document.querySelector('#buttons button:nth-child(3)').addEventListener('click', () => this.initLinks());
        }

        changeVideo() {
            if (this.links.length === 0) {
                alert('직캠이 존재하지 않습니다.');
            } else {
                let link = null;
                do {
                    link = this.links[Math.floor(Math.random() * this.links.length)];
                } while (link === this.cacheLink);

                document.querySelector("iframe").src = link;
                this.cacheLink = link;
            }
        }

        addLinks() {
            const input = document.querySelector('#url');
            const url = input.value.trim();
            const regex1 = /^https:\/\/www\.youtube\.com\/embed\/[\w-]+\?si=[\w-]+$/;
            const regex2 = /^https:\/\/www\.youtube\.com\/watch\?v=[\w-]+$/;

            if (regex1.test(url)) {
                this.links.push(url);
                if (this.isShow) {
                    this.allLinks();
                }
            } else if (regex2.test(url)) {
                this.links.push(url.replace('watch?v=', 'embed/'));
                if (this.isShow) {
                    this.allLinks();
                }
            } else {
                alert('URL을 다시 입력해주세요.' + '\n' +
                    'URL 형식: ' + '\n' +
                    'https://www.youtube.com/embed/ ' + '\n' +
                    'https://www.youtube.com/watch?v=');
            }
            input.value = '';
        }

        allLinks() {
            const linkDiv = document.querySelector('#links');
            this.allLinksInit(linkDiv);

            this.links.forEach(link => {
                const node = document.createElement('iframe');
                node.style.width = '144px';
                node.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
                node.referrerPolicy = "strict-origin-when-cross-origin";
                node.src = link;

                linkDiv.appendChild(node);
            });
            this.isShow = true;
        }

        allLinksInit(linkDiv) {
            linkDiv.innerHTML = '';
        }

        hideAllLinks() {
            const linkDiv = document.querySelector('#links');
            linkDiv.innerHTML = '';
        }

        initLinks() {
            this.links = [];
            this.hideAllLinks();
        }
    }

    new VideoPlayer();
</script>
</html>
